# Runtime Mitigation Strategies

This document describes a **non-destructive runtime mitigation strategy** for recovering from the imaging stack regression without performing a full OS reinstall or Canary re-baseline.

This is a mitigation, not a fix.

The underlying regression remains present until resolved by a future Canary update or driver change.

---

## Design Philosophy

The goal of mitigation is to restore a healthy runtime state while:

- Preserving the current Canary flight
- Avoiding data loss
- Avoiding unnecessary reinstalls
- Maintaining full system control

This approach mirrors how platform and systems teams recover from poisoned runtime state without discarding an otherwise healthy installation.

---

## Effective Recovery Sequence

The following sequence has consistently restored imaging functionality:

1. Shut down WSL to terminate all GPU compute contexts
2. Restart NVIDIA display-related services
3. Restart Desktop Window Manager
4. Disable and re-enable the NVIDIA GPU device

This forces a full teardown and rebuild of GPU driver state and associated runtime mappings.

<img width="1537" height="690" alt="image" src="https://github.com/user-attachments/assets/3bc3d1f4-4f14-4bab-943e-5612c96ef8f8" />

---

## Why This Works

This sequence accomplishes the following:

- Terminates long-lived CUDA contexts
- Flushes poisoned driver and allocator state
- Forces BAR1 remapping
- Reinitializes Desktop Window Manager
- Rebuilds media and imaging pipelines

BAR1 may remain fully mapped after recovery. This does not indicate failure. What matters is **mapping coherence**, not allocation size.

---

## Operational Safeguards

### Secondary Display Strongly Recommended

Disabling the NVIDIA GPU may temporarily black out displays connected through it.

Maintaining visibility via:
- An Intel-driven internal display
- Or a USB-based external display

Prevents blind operations during recovery.

---

## Post-Mitigation Validation

A successful mitigation is confirmed when:

- Screenshot capture functions normally
- Images open correctly in Photos and Paint
- Explorer image previews render
- Desktop composition remains stable
- GPU compute resumes without error

Once these conditions are met, the system is considered back in a healthy runtime state.

---

## Limitations

This mitigation does not prevent recurrence.

Under the same workload class:
- The regression may reappear
- Mitigation may need to be reapplied

This document exists to enable safe continuation of work on unstable Canary builds, not to claim permanent resolution.
